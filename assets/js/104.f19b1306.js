(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{422:function(t,a,s){"use strict";s.r(a);var e=s(8),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_1-aot与jit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-aot与jit"}},[t._v("#")]),t._v(" 1. AOT与JIT")]),t._v(" "),a("p",[a("strong",[t._v("AOT")]),t._v("：Ahead-of-Time（提前"),a("strong",[t._v("编译")]),t._v("）："),a("strong",[t._v("程序执行前")]),t._v("，全部被编译成"),a("strong",[t._v("机器码")])]),t._v(" "),a("p",[a("strong",[t._v("JIT")]),t._v("：Just in Time（即时"),a("strong",[t._v("编译")]),t._v("）: 程序边"),a("strong",[t._v("编译")]),t._v("，边运行；")]),t._v(" "),a("p",[a("strong",[t._v("编译：")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("源代码（.c、.cpp、.go、.java。。。） ===编译===  机器码")])])]),t._v(" "),a("p",[a("strong",[t._v("语言：")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("编译型语言：编译器")])]),t._v(" "),a("li",[a("strong",[t._v("解释型语言：解释器")])])]),t._v(" "),a("h3",{attrs:{id:"_1-complier-与-interpreter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-complier-与-interpreter"}},[t._v("#")]),t._v(" 1. Complier 与 Interpreter")]),t._v(" "),a("p",[t._v("Java："),a("strong",[t._v("半编译半解释")])]),t._v(" "),a("p",[t._v("https://anycodes.cn/editor")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.18c7sotgfbkw.webp",alt:"image"}})]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("对比项")]),t._v(" "),a("th",[a("strong",[t._v("编译器")])]),t._v(" "),a("th",[a("strong",[t._v("解释器")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("机器执行速度")])]),t._v(" "),a("td",[a("strong",[t._v("快")]),t._v("，因为源代码只需被转换一次")]),t._v(" "),a("td",[a("strong",[t._v("慢")]),t._v("，因为每行代码都需要被解释执行")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("开发效率")])]),t._v(" "),a("td",[a("strong",[t._v("慢")]),t._v("，因为需要耗费大量时间编译")]),t._v(" "),a("td",[a("strong",[t._v("快")]),t._v("，无需花费时间生成目标代码，更快的开发和测试")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("调试")])]),t._v(" "),a("td",[a("strong",[t._v("难以调试")]),t._v("编译器生成的目标代码")]),t._v(" "),a("td",[a("strong",[t._v("容易调试")]),t._v("源代码，因为解释器一行一行地执行")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("可移植性（跨平台）")])]),t._v(" "),a("td",[t._v("不同平台需要重新编译目标平台代码")]),t._v(" "),a("td",[t._v("同一份源码可以跨平台执行，因为每个平台会开发对应的解释器")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("学习难度")])]),t._v(" "),a("td",[t._v("相对较高，需要了解源代码、编译器以及目标机器的知识")]),t._v(" "),a("td",[t._v("相对较低，无需了解机器的细节")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("错误检查")])]),t._v(" "),a("td",[t._v("编译器可以在编译代码时检查错误")]),t._v(" "),a("td",[t._v("解释器只能在执行代码时检查错误")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("运行时增强")])]),t._v(" "),a("td",[t._v("无")]),t._v(" "),a("td",[t._v("可以"),a("strong",[t._v("动态增强")])])])])]),t._v(" "),a("h3",{attrs:{id:"_2-aot-与-jit-对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-aot-与-jit-对比"}},[t._v("#")]),t._v(" 2. AOT 与 JIT 对比")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("JIT")]),t._v(" "),a("th",[t._v("AOT")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("优点")]),t._v(" "),a("td",[t._v("1.具备"),a("strong",[t._v("实时调整")]),t._v("能力 "),a("br"),t._v("2.生成"),a("strong",[t._v("最优机器指令")]),t._v(" "),a("br"),t._v("3.根据代码运行情况"),a("strong",[t._v("优化内存占用")])]),t._v(" "),a("td",[t._v("1.速度快，优化了运行时编译时间和内存消耗 "),a("br"),t._v("2.程序初期就能达最高性能 "),a("br"),t._v("3.加快程序启动速度")])]),t._v(" "),a("tr",[a("td",[t._v("缺点")]),t._v(" "),a("td",[t._v("1.运行期边编译"),a("strong",[t._v("速度慢")]),t._v(" "),a("br"),t._v("2.初始编译不能达到"),a("strong",[t._v("最高性能")])]),t._v(" "),a("td",[t._v("1.程序第一次编译占用时间长 "),a("br"),t._v("2.牺牲"),a("strong",[t._v("高级语言")]),t._v("一些特性")])])])]),t._v(" "),a("p",[t._v("在 OpenJDK 的官方 Wiki 上，介绍了HotSpot 虚拟机一个相对比较全面的、**即时编译器（JIT）**中采用的"),a("a",{attrs:{href:"https://xie.infoq.cn/link?target=https%3A%2F%2Fwiki.openjdk.java.net%2Fdisplay%2FHotSpot%2FPerformanceTacticIndex",target:"_blank",rel:"noopener noreferrer"}},[t._v("优化技术列表"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.4v3vnan61si0.webp",alt:"image"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.2yn12g8j4bg0.webp",alt:"image"}})]),t._v(" "),a("p",[t._v("可使用：-XX:+PrintCompilation 打印JIT编译信息")]),t._v(" "),a("h3",{attrs:{id:"_3-jvm架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-jvm架构"}},[t._v("#")]),t._v(" 3. JVM架构")]),t._v(" "),a("p",[t._v(".java === .class === 机器码")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.3f2b0lee2k80.webp",alt:"image"}})]),t._v(" "),a("p",[a("strong",[t._v("JVM")]),t._v(": 既有"),a("strong",[t._v("解释器")]),t._v("，又有"),a("strong",[t._v("编译器（JIT：即时编译）")]),t._v("；")]),t._v(" "),a("h3",{attrs:{id:"_4-java的执行过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-java的执行过程"}},[t._v("#")]),t._v(" 4. Java的执行过程")]),t._v(" "),a("blockquote",[a("p",[t._v("建议阅读：")]),t._v(" "),a("ul",[a("li",[t._v("美团技术：https://tech.meituan.com/2020/10/22/java-jit-practice-in-meituan.html")]),t._v(" "),a("li",[t._v("openjdk官网：https://wiki.openjdk.org/display/HotSpot/Compiler")])])]),t._v(" "),a("h4",{attrs:{id:"_1-流程概要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-流程概要"}},[t._v("#")]),t._v(" 1. 流程概要")]),t._v(" "),a("p",[t._v("IR：中间表示层")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.38prraliiqs0.webp",alt:"image"}})]),t._v(" "),a("blockquote",[a("p",[t._v("解释执行的代码调用次数达到阈值就进行编译，放到代码缓存里")])]),t._v(" "),a("h4",{attrs:{id:"_2-详细流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-详细流程"}},[t._v("#")]),t._v(" 2. 详细流程")]),t._v(" "),a("p",[t._v("热点代码：调用次数非常多的代码")]),t._v(" "),a("p",[t._v("在运行代码的时候可以添加一些额外参数改变内部的一些细节")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.44umhjh4mbc0.webp",alt:"image"}})]),t._v(" "),a("h3",{attrs:{id:"_5-jvm编译器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-jvm编译器"}},[t._v("#")]),t._v(" 5. JVM编译器")]),t._v(" "),a("p",[t._v("JVM中集成了两种编译器，Client Compiler 和 Server Compiler；")]),t._v(" "),a("ul",[a("li",[t._v("Client Compiler注重启动速度和局部的优化")]),t._v(" "),a("li",[t._v("Server Compiler更加关注全局优化，性能更好，但由于会进行更多的全局分析，所以启动速度会慢。")])]),t._v(" "),a("p",[t._v("Client Compiler：")]),t._v(" "),a("ul",[a("li",[t._v("HotSpot VM带有一个Client Compiler "),a("strong",[t._v("C1编译器")])]),t._v(" "),a("li",[t._v("这种编译器"),a("strong",[t._v("启动速度快")]),t._v("，但是性能比较Server Compiler来说会差一些。")]),t._v(" "),a("li",[t._v("编译后的"),a("strong",[t._v("机器码执行效率")]),t._v("没有C2的高")])]),t._v(" "),a("p",[t._v("Server Compiler：")]),t._v(" "),a("ul",[a("li",[t._v("Hotspot虚拟机中使用的Server Compiler有两种："),a("strong",[t._v("C2")]),t._v(" 和 "),a("strong",[t._v("Graal")]),t._v("。")]),t._v(" "),a("li",[t._v("在Hotspot VM中，默认的Server Compiler是"),a("strong",[t._v("C2编译器。")])])]),t._v(" "),a("h3",{attrs:{id:"_6-分层编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-分层编译"}},[t._v("#")]),t._v(" 6. 分层编译")]),t._v(" "),a("p",[t._v("Java 7开始引入了分层编译("),a("strong",[t._v("Tiered Compiler")]),t._v(")的概念，它结合了"),a("strong",[t._v("C1")]),t._v("和"),a("strong",[t._v("C2")]),t._v("的优势，追求启动速度和峰值性能的一个平衡。分层编译将JVM的执行状态分为了五个层次。"),a("strong",[t._v("五个层级")]),t._v("分别是：")]),t._v(" "),a("ol",{attrs:{start:"0"}},[a("li",[a("p",[t._v("解释执行。")])]),t._v(" "),a("li",[a("p",[t._v("执行"),a("strong",[t._v("不带profiling")]),t._v("的C1代码。")])]),t._v(" "),a("li",[a("p",[t._v("执行"),a("strong",[t._v("仅带方法调用次数以及循环回边执行次数profiling")]),t._v("的C1代码。")])]),t._v(" "),a("li",[a("p",[t._v("执行"),a("strong",[t._v("带所有profiling")]),t._v("的C1代码。")])]),t._v(" "),a("li",[a("p",[t._v("执行C2代码。")])])]),t._v(" "),a("p",[a("strong",[t._v("profiling就是收集能够反映程序执行状态的数据")]),t._v("。其中最基本的统计数据就是方法的调用次数，以及循环回边的执行次数。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.61xq63js3740.webp",alt:"image"}})]),t._v(" "),a("ul",[a("li",[t._v("图中第①条路径，代表编译的一般情况，"),a("strong",[t._v("热点方法")]),t._v("从解释执行到被3层的C1编译，最后被4层的C2编译。")]),t._v(" "),a("li",[t._v("如果"),a("strong",[t._v("方法比较小")]),t._v("（比如Java服务中常见的"),a("strong",[t._v("getter/setter")]),t._v("方法），3层的profiling没有收集到有价值的数据，JVM就会断定该方法对于C1代码和C2代码的执行效率相同，就会执行图中第②条路径。在这种情况下，JVM会在3层编译之后，放弃进入C2编译，"),a("strong",[t._v("直接选择用1层的C1编译运行")]),t._v("。")]),t._v(" "),a("li",[t._v("在"),a("strong",[t._v("C1忙碌")]),t._v("的情况下，执行图中第③条路径，在解释执行过程中对程序进行"),a("strong",[t._v("profiling")]),t._v(" ，根据信息直接由第4层的"),a("strong",[t._v("C2编译")]),t._v("。")]),t._v(" "),a("li",[t._v("前文提到C1中的执行效率是"),a("strong",[t._v("1层>2层>3层")]),t._v("，"),a("strong",[t._v("第3层")]),t._v("一般要比"),a("strong",[t._v("第2层")]),t._v("慢35%以上，所以在"),a("strong",[t._v("C2忙碌")]),t._v("的情况下，执行图中第④条路径。这时方法会被2层的C1编译，然后再被3层的C1编译，以减少方法在"),a("strong",[t._v("3层")]),t._v("的执行时间。")]),t._v(" "),a("li",[t._v("如果"),a("strong",[t._v("编译器")]),t._v("做了一些比较"),a("strong",[t._v("激进的优化")]),t._v("，比如分支预测，在实际运行时"),a("strong",[t._v("发现预测出错")]),t._v("，这时就会进行"),a("strong",[t._v("反优化")]),t._v("，重新进入"),a("strong",[t._v("解释执行")]),t._v("，图中第⑤条执行路径代表的就是"),a("strong",[t._v("反优化")]),t._v("。")])]),t._v(" "),a("p",[t._v("总的来说，C1的编译速度更快，C2的编译质量更高，分层编译的不同编译路径，也就是JVM根据当前服务的运行情况来寻找当前服务的最佳平衡点的一个过程。从JDK 8开始，JVM默认开启分层编译。")]),t._v(" "),a("p",[a("strong",[t._v("云原生")]),t._v("：Cloud Native（将一个程序的服务分散到多台机器上）")]),t._v(" "),a("p",[t._v("为了保证替换某个jar包后服务的执行速度，对Java进行了小改版；")]),t._v(" "),a("p",[t._v("最好的效果：")]),t._v(" "),a("p",[t._v("存在的问题：")]),t._v(" "),a("ul",[a("li",[t._v("java应用如果用jar，解释执行，热点代码才编译成机器码；初始启动速度慢，初始处理请求数量少。")]),t._v(" "),a("li",[t._v("大型云平台，要求每一种应用都必须秒级启动。每个应用都要求效率高。")])]),t._v(" "),a("p",[t._v("希望的效果：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("java应用也能提前被编译成"),a("strong",[t._v("机器码")]),t._v("，随时"),a("strong",[t._v("急速启动")]),t._v("，一启动就急速运行，最高性能")])]),t._v(" "),a("li",[a("p",[t._v("编译成机器码的好处：")]),t._v(" "),a("ul",[a("li",[t._v("另外的服务器还需要安装Java环境")])]),t._v(" "),a("ul",[a("li",[t._v("编译成"),a("strong",[t._v("机器码")]),t._v("的，可以在这个平台 Windows X64 "),a("strong",[t._v("直接运行")]),t._v("。")])])])]),t._v(" "),a("p",[a("strong",[t._v("原生")]),t._v("镜像："),a("strong",[t._v("native")]),t._v("-image（机器码、本地镜像）")]),t._v(" "),a("ul",[a("li",[t._v("把应用打包成能适配本机平台 的可执行文件（机器码、本地镜像）")])]),t._v(" "),a("h2",{attrs:{id:"_2-graalvm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-graalvm"}},[t._v("#")]),t._v(" 2. GraalVM")]),t._v(" "),a("p",[t._v("https://www.graalvm.org/")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("GraalVM")]),t._v("是一个高性能的"),a("strong",[t._v("JDK")]),t._v("，旨在"),a("strong",[t._v("加速")]),t._v("用Java和其他JVM语言编写的"),a("strong",[t._v("应用程序")]),t._v("的"),a("strong",[t._v("执行")]),t._v("，同时还提供JavaScript、Python和许多其他流行语言的运行时。")]),t._v(" "),a("p",[a("strong",[t._v("GraalVM")]),t._v("提供了"),a("strong",[t._v("两种")]),t._v("运行"),a("strong",[t._v("Java应用程序")]),t._v("的方式：")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("在HotSpot JVM上使用"),a("strong",[t._v("Graal即时（JIT）编译器")])])])]),t._v(" "),a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("作为"),a("strong",[t._v("预先编译（AOT）"),a("strong",[t._v("的本机")]),t._v("可执行文件")]),t._v("运行（"),a("strong",[t._v("本地镜像")]),t._v("）。")])])])]),t._v(" "),a("p",[t._v("GraalVM的多语言能力使得在单个应用程序中混合多种编程语言成为可能，同时消除了外部语言调用的成本。")])]),t._v(" "),a("h3",{attrs:{id:"_1-架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-架构"}},[t._v("#")]),t._v(" 1. 架构")]),t._v(" "),a("p",[t._v("GraalVm除了支持Java系的语言，还支持其他的语言")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.j5yc8jaugcg.webp",alt:"image"}})]),t._v(" "),a("h3",{attrs:{id:"_2-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装"}},[t._v("#")]),t._v(" 2. 安装")]),t._v(" "),a("p",[t._v("跨平台提供原生镜像原理：")]),t._v(" "),a("p",[t._v("不同平台安装GraalVM，并安装对应的本地集成环境")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.33ivwqyvm940.webp",alt:"image"}})]),t._v(" "),a("h4",{attrs:{id:"_1-visualstudio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-visualstudio"}},[t._v("#")]),t._v(" 1. VisualStudio")]),t._v(" "),a("p",[t._v("https://visualstudio.microsoft.com/zh-hans/free-developer-offers/")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.2tx2wpp75gg0.webp",alt:"image"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.4cbmma7n5bc0.webp",alt:"image"}})]),t._v(" "),a("p",[t._v("别选中文")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.gt6cl52h4yo.webp",alt:"image"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.6rukp2phsyw0.webp",alt:"image"}})]),t._v(" "),a("p",[t._v("记住你安装的地址；")]),t._v(" "),a("h4",{attrs:{id:"_2-graalvm-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-graalvm-2"}},[t._v("#")]),t._v(" 2. GraalVM")]),t._v(" "),a("h5",{attrs:{id:"_1-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装"}},[t._v("#")]),t._v(" 1. 安装")]),t._v(" "),a("p",[t._v("下载 GraalVM + native-image")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.5uvzgszdsxc0.webp",alt:"image"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.6xja4wuvx400.webp",alt:"image"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.1q4mjwc1gsxs.webp",alt:"image"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.3pq7tg4i5zs0.webp",alt:"image"}})]),t._v(" "),a("h5",{attrs:{id:"_2-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置"}},[t._v("#")]),t._v(" 2. 配置")]),t._v(" "),a("p",[t._v("修改 JAVA_HOME 与 Path，指向新bin路径")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.62k6d138a6s0.webp",alt:"image"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.6udcww8ghgw0.webp",alt:"image"}})]),t._v(" "),a("p",[t._v("验证JDK环境为GraalVM提供的即可：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.2bubyiucfehw.webp",alt:"image"}})]),t._v(" "),a("h5",{attrs:{id:"_3-依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-依赖"}},[t._v("#")]),t._v(" 3. 依赖")]),t._v(" "),a("p",[t._v("安装 native-image 依赖：")]),t._v(" "),a("ol",[a("li",[t._v("网络环境好：参考：https://www.graalvm.org/latest/reference-manual/native-image/#install-native-image")])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("gu "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" native-image\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("网络不好，使用我们下载的离线jar;"),a("code",[t._v("native-image-xxx.jar")]),t._v("文件")])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("gu "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--file")]),t._v(" native-image-installable-svm-java17-windows-amd64-22.3.2.jar\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h5",{attrs:{id:"_4-验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-验证"}},[t._v("#")]),t._v(" 4. 验证")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("native-image\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"_3-测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试"}},[t._v("#")]),t._v(" 3. 测试")]),t._v(" "),a("h4",{attrs:{id:"_1-创建项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建项目"}},[t._v("#")]),t._v(" 1. 创建项目")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("创建普通java项目。编写HelloWorld类；")])]),t._v(" "),a("ul",[a("li",[t._v("使用"),a("code",[t._v("mvn clean package")]),t._v("进行打包")])]),t._v(" "),a("ul",[a("li",[t._v("确认jar包是否可以执行"),a("code",[t._v("java -jar xxx.jar")])]),t._v(" "),a("li",[t._v("可能需要给 "),a("code",[t._v("MANIFEST.MF")]),t._v("添加 "),a("code",[t._v("Main-Class: 你的主类")])])])])]),t._v(" "),a("h4",{attrs:{id:"_2-编译镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-编译镜像"}},[t._v("#")]),t._v(" 2. 编译镜像")]),t._v(" "),a("ul",[a("li",[t._v("编译为原生镜像（native-image）：使用"),a("code",[t._v("native-tools")]),t._v("终端")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.6xb3xc4dwuk0.webp",alt:"image"}})]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#从入口开始，编译整个jar")]),t._v("\nnative-image "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-cp")]),t._v(" boot3-15-aot-common-1.0-SNAPSHOT.jar com.atguigu.MainApplication "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" Haha\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编译某个类【必须有main入口方法，否则无法编译】")]),t._v("\nnative-image "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-cp")]),t._v(" ."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("classes org.example.App\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h4",{attrs:{id:"_3-linux平台测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-linux平台测试"}},[t._v("#")]),t._v(" 3. Linux平台测试")]),t._v(" "),a("ul",[a("li",[a("ol",[a("li",[t._v("安装gcc等环境")])])])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" lrzsz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" gcc glibc-devel zlib-devel\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("ul",[a("li",[a("ol",{attrs:{start:"2"}},[a("li",[t._v("下载安装配置Linux下的GraalVM、native-image")])]),t._v(" "),a("ul",[a("li",[t._v("下载：https://www.graalvm.org/downloads/")]),t._v(" "),a("li",[t._v("安装：GraalVM、native-image")]),t._v(" "),a("li",[t._v("配置：JAVA环境变量为GraalVM")])])])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-zxvf")]),t._v(" graalvm-ce-java17-linux-amd64-22.3.2.tar.gz "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-C")]),t._v(" /opt/java/\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/profile\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改以下内容")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("JAVA_HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/java/graalvm-ce-java17-22.3.2\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_HOME")]),t._v("/bin\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /etc/profile\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("ul",[a("li",[a("ol",{attrs:{start:"3"}},[a("li",[t._v("安装native-image")])])])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("gu "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--file")]),t._v(" native-image-installable-svm-java17-linux-amd64-22.3.2.jar\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[a("ol",{attrs:{start:"4"}},[a("li",[t._v("使用native-image编译jar为原生程序")])])])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("native-image "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-cp")]),t._v(" xxx.jar org.example.App\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h2",{attrs:{id:"_3-springboot整合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-springboot整合"}},[t._v("#")]),t._v(" 3. SpringBoot整合")]),t._v(" "),a("h3",{attrs:{id:"_1-依赖导入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-依赖导入"}},[t._v("#")]),t._v(" 1. 依赖导入")]),t._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.graalvm.buildtools"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("native-maven-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-maven-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("h3",{attrs:{id:"_2-生成native-image"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-生成native-image"}},[t._v("#")]),t._v(" 2. 生成native-image")]),t._v(" "),a("p",[t._v("1、运行aot提前处理命令："),a("code",[t._v("mvn springboot:process-aot")])]),t._v(" "),a("p",[t._v("2、运行native打包："),a("code",[t._v("mvn -Pnative native:build")])]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 推荐加上 -Pnative")]),t._v("\nmvn "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Pnative")]),t._v(" native:build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" pom.xml\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.l8orqeewzv4.webp",alt:"image"}})]),t._v(" "),a("h3",{attrs:{id:"_3-常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-常见问题"}},[t._v("#")]),t._v(" 3. 常见问题")]),t._v(" "),a("p",[t._v("可能提示如下各种错误，无法构建原生镜像，需要配置环境变量；")]),t._v(" "),a("ul",[a("li",[t._v("出现"),a("code",[t._v("cl.exe")]),t._v("找不到错误")]),t._v(" "),a("li",[t._v("出现乱码")]),t._v(" "),a("li",[t._v("提示"),a("code",[t._v("no include path set")])]),t._v(" "),a("li",[t._v("提示fatal error LNK1104: cannot open file 'LIBCMT.lib'")]),t._v(" "),a("li",[t._v("提示 LINK : fatal error LNK1104: cannot open file 'kernel32.lib'")]),t._v(" "),a("li",[t._v("提示各种其他找不到")])]),t._v(" "),a("p",[a("strong",[t._v("需要修改三个环境变量")]),t._v("："),a("code",[t._v("Path")]),t._v("、"),a("code",[t._v("INCLUDE")]),t._v("、"),a("code",[t._v("lib")])]),t._v(" "),a("ul",[a("li",[t._v("1、 Path：添加如下值")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.33.31629\\bin\\Hostx64\\x64")])])]),t._v(" "),a("ul",[a("li",[t._v("2、新建"),a("code",[t._v("INCLUDE")]),t._v("环境变量：值为")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.33.31629\\include;C:\\Program Files (x86)\\Windows Kits\\10\\Include\\10.0.19041.0\\shared;C:\\Program Files (x86)\\Windows Kits\\10\\Include\\10.0.19041.0\\ucrt;C:\\Program Files (x86)\\Windows Kits\\10\\Include\\10.0.19041.0\\um;C:\\Program Files (x86)\\Windows Kits\\10\\Include\\10.0.19041.0\\winrt\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.4uxh8orknns0.webp",alt:"image"}})]),t._v(" "),a("ul",[a("li",[t._v("3、新建lib环境变量：值为")])]),t._v(" "),a("div",{staticClass:"language-latex line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-latex"}},[a("code",[t._v("C:"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\Program")]),t._v(" Files"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\Microsoft")]),t._v(" Visual Studio"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\2")]),t._v("022"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\Community")]),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\VC")]),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\Tools")]),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\MSVC")]),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\1")]),t._v("4.33.31629"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\lib")]),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\x")]),t._v("64;C:"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\Program")]),t._v(" Files (x86)"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\Windows")]),t._v(" Kits"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\1")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\Lib")]),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\1")]),t._v("0.0.19041.0"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\um")]),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\x")]),t._v("64;C:"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\Program")]),t._v(" Files (x86)"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\Windows")]),t._v(" Kits"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\1")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\Lib")]),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\1")]),t._v("0.0.19041.0"),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\ucrt")]),a("span",{pre:!0,attrs:{class:"token function selector"}},[t._v("\\x")]),t._v("64\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.statically.io/gh/747721653/picx-images-hosting@master/springboot/image.6gw85mpe7vk0.webp",alt:"image"}})])])}),[],!1,null,null,null);a.default=r.exports}}]);